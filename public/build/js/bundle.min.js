!function(){if(document.querySelector("#cajas")){const a=document.querySelector("#registrar"),n=document.querySelector("#cajaForm"),r=document.querySelector("#btnSubmit");let c,i;const l=document.querySelector("#efectivo-apertura");function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function t(){n.reset(),r.disabled=!1,$("#modal-caja").modal("show"),$("#cajaForm").validate().resetForm(),$("#cajaForm").validate().destroy(),$("#cajaForm").find(".is-invalid").removeClass("is-invalid"),i&&async function(){try{const e=await fetch("/api/caja?id="+i);!function(e){l.value=parseFloat(e).toLocaleString("en")}(await e.json())}catch(e){console.log(e)}}(),o()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const t=new FormData;i&&t.append("id",i),t.append("efectivo_apertura",l.value),r.disabled=!0;let o="";o=i?location.origin+"/api/caja/editar":location.origin+"/api/caja/crear";try{const a=await fetch(o,{body:t,method:"POST"}),i=await a.json();e(),r.disabled=!1,"error"==i.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:i.msg}),$("#modal-caja").modal("hide")):(c.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:i.msg}),n.reset(),$("#modal-caja").modal("hide")),setTimeout(()=>{e()},4e3)}catch(e){}}()}}),$("#cajaForm").validate({rules:{efectivo_apertura:{required:!0}},messages:{efectivo_apertura:{required:"El campo es obligatorio, si el efectivo inicial es cero porfavor digite 0"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}l.addEventListener("input",(function(e){l.value=function(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}(e.target.value)})),$("#tabla").dataTable().fnDestroy(),c=$("#tabla").DataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 to 0 of 0 Entradas",infoFiltered:"(Filtrado de _MAX_ total entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},ajax:"/api/cajas",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0}),a.addEventListener("click",(function(){i=null,t()})),$("#tabla").on("click","#editar",(function(e){i=e.currentTarget.dataset.cajaId,t()})),$("#tabla").on("click","#eliminar",(function(t){!function(t,o){const a=o.currentTarget.parentElement.parentElement.parentElement.childNodes[2].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar esta caja la cual tiene una efectivo de apertura de  <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t),url=location.origin+"/api/caja/eliminar";try{const t=await fetch(url,{body:o,method:"POST"}),a=await t.json();e(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),c.ajax.reload()),setTimeout(()=>{e()},8e3)}catch(e){}}(t)})}(t.currentTarget.dataset.cajaId,t)})),$("#tabla").on("click","#cerrar",(function(t){!function(t,o){Swal.fire({icon:"warning",html:'<h2 class="">¿Está seguro de cerrar esta caja? </h2><br><p>Esta acción no se puede deshacer</p>',showCancelButton:!0,confirmButtonText:"Cerrar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t),url=location.origin+"/api/caja/cerrar";try{const t=await fetch(url,{body:o,method:"POST"}),a=await t.json();e(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),c.ajax.reload()),setTimeout(()=>{e()},8e3)}catch(e){}}(t)})}(t.currentTarget.dataset.cajaId)})),$("#cajaForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#categorias")){let a,n=null;const r=document.querySelector("#registrar"),c=document.querySelector("#categoriaForm"),i=document.querySelector("#categoria");function e(){c.reset(),btnSubmit.disabled=!1,$("#modal-categoria").modal("show"),o(),n&&async function(){try{const e=await fetch("/api/categoria?id="+n);!function(e){i.value=e.categoria}(await e.json())}catch(e){console.log(e)}}()}function t(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;n&&e.append("id",n),e.append("categoria",i.value.trim()),btnSubmit.disabled=!0;let o="";o=n?location.origin+"/api/categoria/editar":location.origin+"/api/categoria/crear";try{const n=await fetch(o,{body:e,method:"POST"}),r=await n.json();t(),btnSubmit.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):(a.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{t()},4e3),c.reset(),$("#modal-categoria").modal("hide"))}catch(e){}}()}}),$("#categoriaForm").validate({rules:{categoria:{required:!0}},messages:{categoria:{required:"El nombre de la categoría es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}$("#tabla").dataTable().fnDestroy(),a=$("#tabla").DataTable({ajax:"/api/categorias",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(a,{buttons:["copy","csv","excel","pdf","print"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),i.addEventListener("input",(function(e){i.value=e.target.value.toUpperCase()})),r.addEventListener("click",(function(){n=null,e()})),$("#tabla").on("click","#editar",(function(t){n=t.currentTarget.dataset.categoriaId,e()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,o){const n=o.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar la categoría <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("id",e),url=location.origin+"/api/categoria/eliminar";try{const e=await fetch(url,{body:o,method:"POST"}),n=await e.json();t(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{t()},8e3),a.ajax.reload())}catch(e){$(document).Toasts("create",{class:"bg-danger",title:"Error",body:"No es Posible eliminar la cateogoría porque tiene productos  asociados"}),setTimeout(()=>{t()},8e3)}}(e)})}(e.currentTarget.dataset.categoriaId,e)})),$("#categoriaForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#clientes")){let a,n=null;const r=document.querySelector("#registrar"),c=document.querySelector("#clienteForm"),i=document.querySelector("#nombre"),l=document.querySelector("#cedula"),s=document.querySelector("#celular"),d=document.querySelector("#direccion"),u=document.querySelector("#email");function e(){c.reset(),btnSubmit.disabled=!1,$("#modal-cliente").modal("show"),o(),n&&async function(){try{const e=await fetch("/api/cliente?id="+n);!function(e){i.value=e.nombre,l.value=e.cedula,s.value=e.celular,d.value=e.direccion,u.value=e.email}(await e.json())}catch(e){console.log(e)}}()}function t(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;n&&e.append("id",n),e.append("nombre",i.value.trim()),e.append("cedula",l.value),e.append("celular",s.value),e.append("direccion",d.value.trim()),e.append("email",u.value.trim()),btnSubmit.disabled=!0;let o="";o=n?location.origin+"/api/cliente/editar":location.origin+"/api/cliente/crear";try{const n=await fetch(o,{body:e,method:"POST"}),r=await n.json();t(),btnSubmit.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):(a.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{t()},4e3),c.reset(),$("#modal-cliente").modal("hide"))}catch(e){}}()}}),$("#clienteForm").validate({rules:{nombre:{required:!0,minlength:6},cedula:{digits:!0,minlength:6},celular:{digits:!0,rangelength:[10,10]},email:{email:!0}},messages:{nombre:{required:"El nombre es obligatorio",minlength:"Debe tener al menos 6 caracteres"},cedula:{digits:"Solo valores númericos",minlength:"Debe tener al menos 6 numeros"},celular:{digits:"solo valores numericos",rangelength:"Debe contener 10 números"},email:{email:"el email no es valido"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}$("#tabla").dataTable().fnDestroy(),a=$("#tabla").DataTable({ajax:"/api/clientes",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(a,{buttons:["copy","csv","excel","pdf","print"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),r.addEventListener("click",(function(){n=null,e()})),$("#tabla").on("click","#editar",(function(t){n=t.currentTarget.dataset.clienteId,e()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,o){const n=o.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar al Cliente <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("id",e),url=location.origin+"/api/cliente/eliminar";try{const e=await fetch(url,{body:o,method:"POST"}),n=await e.json();t(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{t()},8e3),a.ajax.reload())}catch(e){console.log(e)}}(e)})}(e.currentTarget.dataset.clienteId,e)})),$("#clienteForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#inicio")){const e=document.querySelector("#inicio_ingresos"),t=document.querySelector("#inicio_ganancias"),o=document.querySelector("#inicio_costos"),a=document.querySelector("#inicio_inventario"),n=document.querySelector("#inicio_ingresos_reales"),r=document.querySelector("#inicio_ganancias_reales"),c=document.querySelector("#inicio_dinero_fiados"),i=document.querySelector("#inicio_numero_ventas"),l=document.querySelector("#inicio_numero_fiados"),s=document.querySelector("#inicio_numero_pagos"),d=document.querySelector("#inicio_numero_cajas"),u=document.querySelector("#inicio_numero_productos"),m=document.querySelector("#inicio_numero_clientes");!async function(){const p=location.origin+"/api/inicio";try{const g=await fetch(p);!function(p){console.log(p),e.textContent=p.ingresos,t.textContent=p.ganancias,o.textContent=p.costos,a.textContent=p.inventario,n.textContent=p.ingresos_reales,r.textContent=p.ganancias_reales,c.textContent=p.fiados,i.textContent=p.numero_ventas,l.textContent=p.numero_fiados,s.textContent=p.numero_pagos,d.textContent=p.numero_cajas,u.textContent=p.numero_productos,m.textContent=p.numero_clientes}(await g.json())}catch(e){console.log(e)}}()}}(),function(){if(document.querySelector("#egresos")){const a=document.querySelector("#registrar"),n=document.querySelector("#egresoForm"),r=document.querySelector("#btnSubmit");let c,i;const l=document.querySelector("#egreso"),s=document.querySelector("#descripcion");function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function t(){n.reset(),r.disabled=!1,$("#modal-egreso").modal("show"),$("#egresoForm").validate().resetForm(),$("#egresoForm").validate().destroy(),$("#egresoForm").find(".is-invalid").removeClass("is-invalid"),i&&async function(){try{const e=await fetch("/api/egreso?id="+i);!function(e){l.value=parseFloat(e.egreso).toLocaleString("en"),s.value=e.descripcion}(await e.json())}catch(e){console.log(e)}}(),o()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const t=new FormData;i&&t.append("id",i),t.append("egreso",l.value),t.append("descripcion",s.value),r.disabled=!0;let o="";o=i?location.origin+"/api/egreso/editar":location.origin+"/api/egreso/crear";try{const a=await fetch(o,{body:t,method:"POST"}),i=await a.json();e(),r.disabled=!1,"error"==i.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:i.msg}),$("#modal-egreso").modal("hide")):(c.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:i.msg}),n.reset(),$("#modal-egreso").modal("hide")),setTimeout(()=>{e()},4e3)}catch(e){}}()}}),$("#egresoForm").validate({rules:{ingreso:{required:!0},descripcion:{required:!0}},messages:{ingreso:{required:"El monto que sale de la caja es obligatorio"},descripcion:{required:"La nota o descripción es obligatoria"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}l.addEventListener("input",(function(e){l.value=function(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}(e.target.value)})),$("#tabla").dataTable().fnDestroy(),c=$("#tabla").DataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 to 0 of 0 Entradas",infoFiltered:"(Filtrado de _MAX_ total entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},ajax:"/api/egresos",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0}),$.ajax({url:"/api/egresos",dataType:"json",success:function(e){console.log(e)},error:function(e){console.log(e.resposeText)}}),a.addEventListener("click",(function(){i=null,t()})),$("#tabla").on("click","#editar",(function(e){i=e.currentTarget.dataset.egresoId,t()})),$("#tabla").on("click","#eliminar",(function(t){!function(t,o){const a=o.currentTarget.parentElement.parentElement.parentElement.childNodes[3].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el egreso por un valor de <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t),url=location.origin+"/api/egreso/eliminar";try{const t=await fetch(url,{body:o,method:"POST"}),a=await t.json();e(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),c.ajax.reload()),setTimeout(()=>{e()},8e3)}catch(e){}}(t)})}(t.currentTarget.dataset.egresoId,t)})),$("#egresoForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#ingresos")){const a=document.querySelector("#registrar"),n=document.querySelector("#ingresoForm"),r=document.querySelector("#btnSubmit");let c,i;const l=document.querySelector("#ingreso"),s=document.querySelector("#descripcion");function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function t(){n.reset(),r.disabled=!1,$("#modal-ingreso").modal("show"),$("#ingresoForm").validate().resetForm(),$("#ingresoForm").validate().destroy(),$("#ingresoForm").find(".is-invalid").removeClass("is-invalid"),i&&async function(){try{const e=await fetch("/api/ingreso?id="+i);!function(e){l.value=parseFloat(e.ingreso).toLocaleString("en"),s.value=e.descripcion}(await e.json())}catch(e){console.log(e)}}(),o()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const t=new FormData;i&&t.append("id",i),t.append("ingreso",l.value),t.append("descripcion",s.value),r.disabled=!0;let o="";o=i?location.origin+"/api/ingreso/editar":location.origin+"/api/ingreso/crear";try{const a=await fetch(o,{body:t,method:"POST"}),i=await a.json();e(),r.disabled=!1,"error"==i.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:i.msg}),$("#modal-ingreso").modal("hide")):(c.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:i.msg}),n.reset(),$("#modal-ingreso").modal("hide")),setTimeout(()=>{e()},4e3)}catch(e){}}()}}),$("#ingresoForm").validate({rules:{ingreso:{required:!0},descripcion:{required:!0}},messages:{ingreso:{required:"El monto que ingresa en la caja es obligatorio"},descripcion:{required:"La nota o descripción es obligatoria"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}l.addEventListener("input",(function(e){l.value=function(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}(e.target.value)})),$("#tabla").dataTable().fnDestroy(),c=$("#tabla").DataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 to 0 of 0 Entradas",infoFiltered:"(Filtrado de _MAX_ total entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},ajax:"/api/ingresos",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0}),$.ajax({url:"/api/ingresos",dataType:"json",success:function(e){console.log(e)},error:function(e){console.log(e.resposeText)}}),a.addEventListener("click",(function(){i=null,t()})),$("#tabla").on("click","#editar",(function(e){i=e.currentTarget.dataset.ingresoId,t()})),$("#tabla").on("click","#eliminar",(function(t){!function(t,o){const a=o.currentTarget.parentElement.parentElement.parentElement.childNodes[3].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el ingreso por un valor de <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t),url=location.origin+"/api/ingreso/eliminar";try{const t=await fetch(url,{body:o,method:"POST"}),a=await t.json();e(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),c.ajax.reload()),setTimeout(()=>{e()},8e3)}catch(e){}}(t)})}(t.currentTarget.dataset.ingresoId,t)})),$("#ingresoForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#loginForm")){const o=document.querySelector("#email"),a=document.querySelector("#password"),n=document.querySelector("#btnSubmit");async function e(){n.disabled=!0;const e=new FormData;e.append("email",o.value.trim()),e.append("password",a.value);try{const t="/api/usuario/login",o=await fetch(t,{body:e,method:"POST"}),a=await o.json();document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove(),"error"==a.type?(n.disabled=!1,$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg})):window.location.href="/inicio"}catch(e){}}function t(){$.validator.setDefaults({submitHandler:function(){e()}}),$("#loginForm").validate({rules:{email:{required:!0},password:{required:!0}},messages:{email:{required:"El usuario es obligatorio"},password:{required:"El password es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}t(),$("#loginForm").on("valid",(function(e){t()}))}}(),function(){if(document.querySelector("#usuarios")){let n,r=null;const c=document.querySelector("#registrar"),i=document.querySelector("#usuarioForm"),l=document.querySelector("#btnSubmit"),s=document.querySelector("#nombre"),d=document.querySelector("#email"),u=document.querySelector("#estado"),m=document.querySelector("#roll"),p=document.querySelector("#password");function e(){$("#usuarioForm").validate().destroy(),i.reset(),l.disabled=!1,o(u),o(m);const e=document.createElement("OPTION");e.setAttribute("disabled","disabled"),e.setAttribute("selected","selected"),e.textContent="--Seleccione--";const t=document.createElement("OPTION");t.value=0,t.textContent="Inactivo";const n=document.createElement("OPTION");n.value=1,n.textContent="Activo";const c=document.createElement("OPTION");c.setAttribute("disabled","disabled"),c.setAttribute("selected","selected"),c.textContent="--Seleccione--";const p=document.createElement("OPTION");p.value=0,p.textContent="Vendedor";const g=document.createElement("OPTION");g.value=1,g.textContent="Administrador",u.appendChild(e),u.appendChild(t),u.appendChild(n),m.appendChild(c),m.appendChild(p),m.appendChild(g),$("#modal-usuario").modal("show"),a(),r&&async function(){try{const e=await fetch("/api/usuario?id="+r);!function(e){s.value=e.nombre,d.value=e.email;u.querySelector('option[value="'+e.estado+'"]').setAttribute("selected","selected");m.querySelector('option[value="'+e.roll+'"]').setAttribute("selected","selected")}(await e.json())}catch(e){console.log(e)}}()}function t(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function o(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function a(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;r&&e.append("id",r),e.append("nombre",s.value.trim()),e.append("email",d.value),e.append("estado",u.value),e.append("roll",m.value),e.append("password",p.value),l.disabled=!0;let o="";o=r?location.origin+"/api/usuario/editar":location.origin+"/api/usuario/crear";try{const a=await fetch(o,{body:e,method:"POST"}),r=await a.json();console.log(r),l.disabled=!1,t(),l.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):($(document).Toasts("create",{class:"bg-primary",title:"Completado",body:r.msg}),setTimeout(()=>{t()},4e3),i.reset(),$("#modal-usuario").modal("hide"),n.ajax.reload())}catch(e){}}()}});let e={},o={};r||(e={required:!0,minlength:6},o={required:"El password es obligatorio",minlength:"El Password debe tener al menos 6 caracteres"}),$("#usuarioForm").validate({rules:{nombre:{required:!0},email:{required:!0},estado:{required:!0},roll:{required:!0},password:e,terms:{required:!0}},messages:{nombre:{required:"El nombre es obligatorio"},email:{required:"El Usuario es obligatorio"},estado:{required:"el estado es obligatorio"},roll:{required:"el Roll es obligatorio"},password:o},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}c.addEventListener("click",(function(){r=null,e()})),s.addEventListener("input",(function(e){s.value=e.target.value.toUpperCase()})),$("#tabla").dataTable().fnDestroy(),n=$("#tabla").DataTable({ajax:"/api/usuarios",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(n,{buttons:["copy","csv","excel","pdf","print","colvis"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),$("#tabla").on("click","#editar",(function(t){r=t.currentTarget.dataset.usuarioId,e()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,o){const a=o.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar al usuario <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("id",e),url=location.origin+"/api/usuario/eliminar";try{const e=await fetch(url,{body:o,method:"POST"}),a=await e.json();t(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),setTimeout(()=>{t()},8e3),n.ajax.reload())}catch(e){console.log(e)}}(e)})}(e.currentTarget.dataset.usuarioId,e)})),$("#usuarioForm").on("valid",(function(e){a()}))}}(),function(){if(document.querySelector("#seccion-crear-ventas")){const e=document.querySelector("#selectProductos");!async function(){try{const t=await fetch(location.origin+"/api/productos-ventas"),o=await t.json(),a=document.createElement("OPTION");a.textContent="--seleccione un producto--",a.value="0",e.appendChild(a),o.forEach(t=>{const o=document.createElement("OPTION");o.value=t.id,o.textContent=t.nombre,e.appendChild(o)}),$("#selectProductos").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}catch(e){}$("#selectProductos").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}()}}(),function(){if(document.querySelector("#seccion-crear-ventas")){let d,u,m=null,p={id:"",nombre:"",cantidad:"",precio_compra:"",precio_venta:"",precio_original:"",valor_total:"",stock:""},g={total_sin_descuento:"",total_pagar:"",descuento:"",costo:""},f=!0,v=[];const h=document.querySelector("#selectClientes"),b=document.querySelector("#guardar-venta"),y=document.querySelector("#total"),S=document.querySelector("#descuento"),C=document.querySelector("#total_pagar"),T=document.querySelector("#metodo_pago"),q=document.querySelector("#pago-contado"),_=document.querySelector("#pago-cuotas"),E=document.querySelector("#cantidad_pagar"),w=document.querySelector("#cantidad_cambio"),x=document.querySelector("#abono"),L=document.querySelector("#saldo"),F=document.querySelector("#nombre_cliente"),j=document.querySelector("#cedula_cliente"),N=document.querySelector("#celular_cliente"),D=document.querySelector("#direccion_cliente"),P=document.querySelector("#email_cliente"),k=document.querySelector("#agregar-cliente"),O=document.querySelector("#quitar-cliente"),I=document.querySelector("#contenedorCliente"),R=document.querySelector("#codigo-venta");async function e(){try{const e=await fetch(location.origin+"/api/codigo-venta"),t=await e.json();R.value=t}catch(e){}}async function t(e){try{const o=await fetch(`${location.origin}/api/cliente?id=${e}`),a=await o.json();l(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):(setTimeout(()=>{l()},4e3),t=a,F.value=t.nombre??"",j.value=t.cedula??"",N.value=t.celular??"",D.value=t.direccion??"",P.value=t.email??"")}catch(e){}var t}function o(){$("#selectClientes").val("0").trigger("change.select2"),F.value="",j.value="",N.value="",D.value="",P.value=""}function a(){const e=document.querySelector("#productosVenta");i(e),v.forEach(t=>{const{id:o,nombre:i,precio_venta:l,cantidad:s,valor_total:d,stock:m}=t,p=document.createElement("DIV");p.classList.add("row","px-2"),p.dataset.productoId=o;const g=document.createElement("DIV");g.classList.add("col-sm-4");const h=document.createElement("DIV");h.classList.add("input-group","mb-3");const b=document.createElement("DIV");b.classList.add("input-group-prepend"),b.innerHTML='<span class="input-group-text bg-icono btn pointer"><i class="fa-solid fa-trash text-danger"></i></span>',b.onclick=()=>{var e;e=o,v=v.filter(t=>t.id!=e),a()};const y=document.createElement("INPUT");y.type="text",y.classList.add("form-control"),y.readOnly=!0,y.value=i,y.dataset.productoId=o,h.appendChild(b),h.appendChild(y),g.appendChild(h);const S=document.createElement("DIV");S.classList.add("col-sm-2");const C=document.createElement("DIV");C.classList.add("input-group","mb-3");const T=document.createElement("DIV");T.classList.add("input-group-prepend"),T.dataset.productoId=o,T.innerHTML='<span class="input-group-text bg-icono"> <i class="fas fa-hashtag text-azul"></i></i></span>';const q=document.createElement("INPUT");q.type="number",q.classList.add("form-control"),q.value=s,u==o&&1==f&&setTimeout((function(){q.focus()}),0),q.oninput=function(){parseFloat(q.value)>parseFloat(m)?(Swal.fire({icon:"warning",text:"el producto está agotado"}),r(m,o,!0)):r(q.value,o,!0)},C.appendChild(T),C.appendChild(q),S.appendChild(C);const _=document.createElement("DIV");_.classList.add("col-sm-3");const E=document.createElement("DIV");E.classList.add("input-group","mb-3");const $=document.createElement("DIV");$.classList.add("input-group-prepend"),$.innerHTML='<span class="input-group-text bg-icono"> <i class="fas fa-dollar-sign text-azul"></i></i></span>';const w=document.createElement("INPUT");w.type="text",w.classList.add("form-control"),w.value=parseFloat(l).toLocaleString("en"),u==o&&0==f&&setTimeout((function(){w.focus()}),0),w.oninput=()=>{const e=c(w.value);w.value=e,r(w.value,o,!1)},w.focus(),E.appendChild($),E.appendChild(w),_.appendChild(E);const x=document.createElement("DIV");x.classList.add("col-sm-3");const L=document.createElement("DIV");L.classList.add("input-group","mb-3");const F=document.createElement("DIV");F.classList.add("input-group-prepend"),F.dataset.productoId=o,F.innerHTML='<span class="input-group-text bg-icono"> <i class="fas fa-dollar-sign text-azul"></i></i></span>';const j=document.createElement("INPUT");j.type="text",j.readOnly=!0,j.classList.add("form-control"),j.value=parseFloat(d).toLocaleString("en"),L.appendChild(F),L.appendChild(j),x.appendChild(L),p.appendChild(g),p.appendChild(S),p.appendChild(_),p.appendChild(x),e.appendChild(p),n()}),function(){let e=0,t=0,o=0;v.forEach(a=>{e+=a.cantidad*a.precio_original,t+=a.cantidad*a.precio_venta,o+=a.cantidad*a.precio_compra});const a=100-100*t/e;S.value=isNaN(Number(a.toFixed(2)))?"0%":Number(a.toFixed(2))+"%",y.value=e.toLocaleString("en"),C.value=t.toLocaleString("en"),g.total_sin_descuento=e,g.total_pagar=t,g.descuento=isNaN(Number(a.toFixed(2)))?0:Number(a.toFixed(2)),g.costo=o}()}function n(){E.value="",w.value="",x.value="",L.value=g.total_pagar.toLocaleString("en")}function r(e,t,o){if(u=t,o)f=!0,v=v.map(o=>o.id==t?(e<0&&(e=0),{...o,cantidad:e,valor_total:e*o.precio_venta}):o);else{f=!1;let o=parseFloat(e.replace(/,/g,""));v=v.map(a=>a.id==t?(""==e&&(e=0),isNaN(o*a.cantidad)?{...a,precio_venta:0,valor_total:0}:{...a,precio_venta:o,valor_total:o*a.cantidad}):a)}a()}function c(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}function i(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function l(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function s(){i(h);try{const e=await fetch(location.origin+"/api/clientes-ventas"),o=await e.json(),a=document.createElement("OPTION");a.textContent="--seleccione un cliente--",a.value="0",h.appendChild(a),o.forEach(e=>{const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.nombre,e.id==m&&(t.selected=!0),h.appendChild(t)}),$("#selectClientes").select2(),$(".select2bs4").select2({theme:"bootstrap4"}),t(m)}catch(e){}$("#selectProductos").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}!function(){const t=new URL(window.location),o=new URLSearchParams(t.search);1==o.size?(d=atob(o.get("id")),async function(){const e=`${location.origin}/api/venta?id=${d}`;try{const t=await fetch(e);!function(e){m=e.cliente_id;const t=e.productos_venta,o=e.venta;R.value=o.codigo;let n=0;t.forEach(e=>{p={id:e.id,nombre:e.nombre,cantidad:e.cantidad,precio_compra:e.precio_compra,precio_venta:e.precio,precio_original:e.precio_venta,valor_total:e.precio*e.cantidad,stock:parseFloat(e.stock)+parseFloat(e.cantidad)},n=parseFloat(n)+parseFloat(e.precio_venta)*e.cantidad,v.push(p)}),a(),y.value=n.toLocaleString("en"),S.value=e.venta.descuento+"%",C.value=parseFloat(e.venta.total).toLocaleString("en"),(""!=o.nombre_cliente||""!=o.cedula_cliente||""!=o.celular_cliente||""!=o.direccion_cliente||null!=o.nombre)&&(I.classList.remove("d-none"),F.value=o.nombre_cliente,j.value=o.cedula_cliente,N.value=o.celular_cliente,D.value=o.direccion_cliente,P.value=o.email_cliente);if(2==o.metodo_pago){document.querySelector('#metodo_pago option[value="2"]').selected=!0,x.value=parseFloat(o.recaudo).toLocaleString("en"),L.value=(o.total-o.recaudo).toLocaleString("en"),q.classList.add("d-none"),_.classList.remove("d-none")}}(await t.json())}catch(e){}}(),s()):(e(),s())}(),b.addEventListener("click",(function(){!function(){if(0==v.length)return void Swal.fire({icon:"error",text:"No Hay productos agregados a esta venta"});if(1!=T.value&&0==h.value)return void Swal.fire({icon:"error",text:"Para las ventas a credito es necesario seleccionar un cliente que se encuentre registrado"});!async function(){const t=new FormData;d&&t.append("id",d);t.append("productosArray",JSON.stringify(v)),t.append("total",g.total_pagar),t.append("costo",g.costo),t.append("descuento",g.descuento),t.append("metodo_pago",T.value),1!=T.value?(valor_abono=0,""!=x.value&&(valor_abono=x.value),t.append("abono",valor_abono),t.append("saldo",L.value),t.append("cliente_id",h.value),t.append("recaudo",valor_abono),parseFloat(valor_abono)<parseFloat(g.total_pagar)?t.append("estado",0):t.append("estado",1)):(t.append("estado",1),t.append("recaudo",g.total_pagar));let n;t.append("nombre_cliente",F.value),t.append("cedula_cliente",j.value),t.append("celular_cliente",N.value),t.append("direccion_cliente",D.value),t.append("email_cliente",P.value),n=d?location.origin+"/api/editar-venta":location.origin+"/api/crear-venta";b.disabled=!0;try{const r=await fetch(n,{method:"POST",body:t}),c=await r.json();l(),"error"==c.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:c.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:c.msg}),function(){d=null,v=[],p={id:"",nombre:"",cantidad:"",precio_compra:"",precio_venta:"",precio_original:"",valor_total:"",stock:""},g={total_sin_descuento:"",total_pagar:"",descuento:"",costo:""};const t=$("#selectProductos"),n=$("#selectClientes");t.val("0").trigger("change.select2"),n.val("0").trigger("change.select2"),T.innerHTML='\n                <option value="1">Pago e Contado</option>\n                <option value="2">Pago a Cuotas</option>\n            ',E.value="",w.value="",x.value="",L.value="",I.classList.contains("d-none")||I.classList.add("d-none");const r=document.querySelector("#pago-contado"),c=document.querySelector("#pago-cuotas");c.classList.contains("d-none")||c.classList.add("d-none");r.classList.contains("d-none")&&r.classList.remove("d-none");e(),o(),a()}()),b.disabled=!1,setTimeout(()=>{l()},8e3)}catch(e){}}()}()})),T.addEventListener("change",(function(){I.classList.contains("d-none")&&I.classList.remove("d-none"),q.classList.contains("d-none")&&q.classList.remove("d-none"),_.classList.contains("d-none")&&_.classList.remove("d-none"),2==T.value?(x.value="",L.value=g.total_pagar.toLocaleString("en"),o(),F.readOnly=!0,j.readOnly=!0,N.readOnly=!0,D.readOnly=!0,P.readOnly=!0,O.disabled=!0,q.classList.add("d-none")):(m=null,F.readOnly=!1,j.readOnly=!1,N.readOnly=!1,D.readOnly=!1,P.readOnly=!1,O.disabled=!1,I.classList.add("d-none"),_.classList.add("d-none"))})),k.addEventListener("click",(function(){I.classList.contains("d-none")&&I.classList.remove("d-none")})),O.addEventListener("click",(function(){o(),I.classList.add("d-none")})),E.addEventListener("input",(function(e){E.value=c(e.target.value);const t=parseFloat(E.value.replace(/,/g,""))-g.total_pagar;w.value=t.toLocaleString("en")})),x.addEventListener("input",(function(e){x.value=c(e.target.value);const t=parseFloat(x.value.replace(/,/g,"")),o=g.total_pagar-t;L.value=o.toLocaleString("en")})),C.addEventListener("input",(function(e){if(0==v.length)return void(C.value=0);C.value=c(e.target.value);const t=parseFloat(C.value.replace(/,/g,""));let o=0;v.forEach(e=>{o+=e.cantidad*e.precio_original});const a=100-100*t/o;S.value=isNaN(Number(a.toFixed(2)))?"0%":Number(a.toFixed(2))+"%",g.total_pagar=t,g.descuento=a,n()})),$("#selectProductos").on("select2:select",(function(e){!async function(e){try{const t=await fetch(`${location.origin}/api/producto?id=${e}`),o=await t.json();if(o.stock>0){const{id:e,nombre:t,precio_venta:n,stock:r,precio_compra:c}=o;p={id:e,nombre:t,cantidad:1,precio_compra:c,precio_venta:n,precio_original:parseFloat(n),valor_total:n,stock:r};v.some(t=>t.id==e)?Swal.fire({icon:"warning",text:"el producto ya ha sido agregado anteriormente"}):(v.push(p),a())}else Swal.fire({icon:"error",text:"Producto no disponible en inventario"})}catch(e){}}(e.target.value)})),$("#selectClientes").on("select2:select",(function(e){0!=e.target.value?t(e.target.value):o()}))}}(),function(){if(document.querySelector("#ventas")){$("#tabla").on("click","#info",(function(e){!async function(e){$("#modal-info").modal("show");const t=`${location.origin}/api/venta?id=${e}`;try{const e=await fetch(t);!function(e){const{productos_venta:t,venta:o}=e,a=document.querySelector("#codigo-venta"),n=document.querySelector("#cliente-venta"),r=document.querySelector("#fecha-venta"),c=document.querySelector("#total-venta"),i=document.querySelector("#recaudo-venta"),l=document.querySelector("#saldo-venta"),s=document.querySelector("#metodo-venta"),d=document.querySelector("#estado-venta");a.textContent=o.codigo,n.textContent=o.nombre_cliente,r.textContent=o.fecha,c.textContent=parseFloat(o.total).toLocaleString("en"),i.textContent=parseFloat(o.recaudo).toLocaleString("en"),l.textContent=parseFloat(o.total-o.recaudo).toLocaleString("en"),2==o.metodo_pago&&(s.textContent="Fiado");1==o.metodo_pago&&(s.textContent="De Contado");d.classList.contains("text-danger")&&d.classList.remove("text-danger");d.classList.contains("text-success")&&d.classList.remove("text-success");0==o.estado?(d.textContent="Pendiente",d.classList.add("text-danger")):(d.textContent="Pagado",d.classList.add("text-success"));const u=document.querySelector("#body-productos-venta");(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)})(u),t.forEach(e=>{const{nombre:t,cantidad:o,precio:a}=e,n=document.createElement("TR"),r=document.createElement("td");r.textContent=t;const c=document.createElement("td");c.textContent=o;const i=document.createElement("td");i.textContent=parseFloat(a).toLocaleString("en");const l=document.createElement("td");l.textContent=parseFloat(a*o).toLocaleString("en"),n.appendChild(r),n.appendChild(c),n.appendChild(i),n.appendChild(l),u.appendChild(n)})}(await e.json())}catch(e){}}(e.currentTarget.dataset.ventaId)}))}}(),function(){if(document.querySelector("#reportes"));}(),function(){if(document.querySelector("#reporte")){const t=document.querySelector("#reporte_ingresos"),o=document.querySelector("#reporte_ganancias"),a=document.querySelector("#reporte_costos"),n=document.querySelector("#reporte_inventario"),r=document.querySelector("#reporte_ingresos_reales"),c=document.querySelector("#reporte_ganancias_reales"),i=document.querySelector("#reporte_dinero_fiados"),l=document.querySelector("#reporte_numero_ventas"),s=document.querySelector("#reporte_numero_fiados"),d=document.querySelector("#reporte_numero_pagos"),u=document.querySelector("#reporte_numero_cajas"),m=document.querySelector("#reporte_numero_productos"),p=document.querySelector("#reporte_numero_clientes"),g=document.querySelector("#fecha");async function e(e){const g=new FormData;g.append("fecha",e);const f=location.origin+"/api/info-general";try{const e=await fetch(f,{method:"POST",body:g});!function(e){t.textContent=e.ingresos,o.textContent=e.ganancias,a.textContent=e.costos,n.textContent=e.inventario,r.textContent=e.ingresos_reales,c.textContent=e.ganancias_reales,i.textContent=e.fiados,l.textContent=e.numero_ventas,s.textContent=e.numero_fiados,d.textContent=e.numero_pagos,u.textContent=e.numero_cajas,m.textContent=e.numero_productos,p.textContent=e.numero_clientes}(await e.json())}catch(e){console.log(e)}}g.addEventListener("input",(function(t){e(t.target.value)})),function(){const t=new Date;t.setMonth(t.getMonth()-1);const o=t.toISOString().slice(0,10);g.value=o,e(g.value)}()}}(),function(){if(document.querySelector("#ventas")){let t;function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}$("#tabla").on("click","#editar",(function(t){id=t.currentTarget.dataset.ventaId,async function(t){const o=new FormData;o.append("id",t);const a=location.origin+"/api/revisar-venta";try{const n=await fetch(a,{method:"POST",body:o}),r=await n.json();if(e(),"error"==r.type)$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg});else{const e=t.toString();window.location="/crear-venta?id="+btoa(e)}setTimeout(()=>{e()},8e3)}catch(e){}}(id)})),$("#tabla").on("click","#eliminar",(function(o){!function(o,a){const n=a.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar la venta numero <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(a=>{a.isConfirmed&&async function(o){const a=new FormData;a.append("id",o),url=location.origin+"/api/venta/eliminar";try{const o=await fetch(url,{body:a,method:"POST"}),n=await o.json();console.log(n),e(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{e()},8e3),t.ajax.reload())}catch(e){}}(o)})}(o.currentTarget.dataset.ventaId,o)})),$("#tabla").dataTable().fnDestroy(),t=$("#tabla").DataTable({ajax:"/api/ventas",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0})}}(),function(){if(document.querySelector("#seccion-fiados")){const e=document.querySelector("#selectClientes");!async function(){try{const t=await fetch(location.origin+"/api/clientes-ventas"),o=await t.json(),a=document.createElement("OPTION");a.textContent="--seleccione un cliente--",a.value="0",e.appendChild(a),o.forEach(t=>{const o=document.createElement("OPTION");o.value=t.id,o.textContent=t.nombre,e.appendChild(o)}),$("#selectClientes").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}catch(e){}$("#selectProductos").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}()}}(),function(){if(document.querySelector("#seccion-fiados")){let n={monto:0,deuda:0,saldo:0,cliente_id:""},r=[],c="";const i=document.querySelector("#btnSubmitPago"),l=document.querySelector("#body-fiados"),s=document.querySelector("#body-pagos"),d=document.querySelector("#total-deuda"),u=document.querySelector("#pagar"),m=document.querySelector("#pagoForm"),p=document.querySelector("#deuda-actual"),g=document.querySelector("#pagar-todo"),f=document.querySelector("#monto"),v=document.querySelector("#saldo-restante");function e(){n.saldo=n.deuda-n.monto,isNaN(n.saldo)&&(n.saldo=n.deuda),v.textContent="$"+parseFloat(n.saldo).toLocaleString("en")}async function t(e){c=e;try{v.textContent="$0";const i=await fetch(`${location.origin}/api/pagos-cuotas?id=${e}`),u=await i.json();if(o(l),o(s),0==u.fiados.length)Swal.fire({icon:"warning",text:"No hay fiados para este cliente"}),d.textContent=0,n.deuda=0,n.monto=0,n.saldo=0;else{const{fiados:e,pagos_cuotas:i}=u;!function(e){let t=0;e.forEach(e=>{const{codigo:a,venta_id:c,total:i,recaudo:s,estado:d}=e;0!=d&&r.push();const u=document.createElement("TR"),m=document.createElement("TD");m.textContent="#"+a;const p=document.createElement("TD");p.textContent="$"+parseFloat(i).toLocaleString("en");const g=document.createElement("TD");g.textContent="$"+parseFloat(s).toLocaleString("en");const f=document.createElement("TD");f.textContent="$"+parseFloat(i-s).toLocaleString("en");const v=document.createElement("TD"),h=document.createElement("DIV");h.classList.add("d-flex","justify-content-left","text-center");const b=document.createElement("BUTTON");b.type="button",b.classList.add("btn","w-40","btn-inline","btn-sm"),0==d?(t=t+parseFloat(i)-parseFloat(s),b.textContent="Pendiente",b.classList.add("btn-danger")):(b.textContent="Pagado",b.classList.add("bg-azul","text-white")),h.appendChild(b),v.appendChild(h);const y=document.createElement("TD"),S=document.createElement("DIV");S.classList.add("d-flex","ustify-content-start");const C=document.createElement("BUTTON");C.type="button",C.classList.add("btn","btn-sm","bg-hover-azul","text-white","toolMio"),C.innerHTML='<span class="toolMio-text">Ver</span><i class="fas fa-search"></i>',C.onclick=()=>{!async function(e){$("#modal-info").modal("show");try{const t=await fetch(`${location.origin}/api/productos-fiados?venta-id=${e.venta_id}`),a=await t.json();"error"==a.type?Swal.fire({icon:"error",text:a.msg}):function(e,t){const a=document.querySelector("#codigo-venta"),n=document.querySelector("#cliente-venta"),r=document.querySelector("#fecha-venta"),c=document.querySelector("#total-venta"),i=document.querySelector("#recaudo-venta"),l=document.querySelector("#saldo-venta");a.textContent=e.codigo,n.textContent=e.nombre_cliente,r.textContent=e.fecha,c.textContent=parseFloat(e.total).toLocaleString("en"),i.textContent=parseFloat(e.recaudo).toLocaleString("en"),l.textContent=parseFloat(e.total-e.recaudo).toLocaleString("en");const s=document.querySelector("#body-productos-fiados");o(s),t.forEach(e=>{const{nombre:t,cantidad:o,precio:a}=e,n=document.createElement("TR"),r=document.createElement("td");r.textContent=t;const c=document.createElement("td");c.textContent=o;const i=document.createElement("td");i.textContent=parseFloat(a).toLocaleString("en");const l=document.createElement("td");l.textContent=parseFloat(a*o).toLocaleString("en"),n.appendChild(r),n.appendChild(c),n.appendChild(i),n.appendChild(l),s.appendChild(n)})}(e,a)}catch(e){}}(e)},S.appendChild(C),y.appendChild(S),u.appendChild(m),u.appendChild(p),u.appendChild(g),u.appendChild(f),u.appendChild(v),u.appendChild(y),l.appendChild(u),n.cliente_id=e.cliente_id}),d.textContent=parseFloat(t).toLocaleString("en"),n.deuda=t,n.saldo=t}(e),i.forEach(e=>{const{numero_pago:o,monto:n,fecha_pago:r}=e,i=document.createElement("TR"),l=document.createElement("TD");l.textContent="#"+o;const d=document.createElement("TD");d.textContent="$"+parseFloat(n).toLocaleString("en");const u=document.createElement("TD");u.textContent=r;const m=document.createElement("TD"),p=document.createElement("DIV");p.classList.add("d-flex","ustify-content-start");const g=document.createElement("BUTTON");g.type="button",g.classList.add("btn","btn-sm","bg-hover-azul","text-white","toolMio"),g.innerHTML='<span class="toolMio-text">Eliminar</span><i class="fas fa-trash"></i>',g.onclick=function(){!function(e){Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el pago por un valor de <span class="font-weight-bold"> ${parseFloat(e.monto).toLocaleString("en")} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("numero_pago",e.numero_pago);const n=location.origin+"/api/eliminar-pago";try{const e=await fetch(n,{method:"POST",body:o}),r=await e.json();a(),"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):(console.log(r),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),t(c)),setTimeout(()=>{a()},8e3)}catch(e){}}(e)})}(e)},p.appendChild(g),m.appendChild(p),i.appendChild(l),i.appendChild(d),i.appendChild(u),i.appendChild(m),s.appendChild(i)})}}catch(e){console.log(e)}}function o(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function a(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}g.addEventListener("click",(function(){n.monto=n.deuda,f.value=parseFloat(n.monto).toLocaleString("en"),e()})),f.addEventListener("input",(function(t){const o=t.target.value;let a=parseFloat(o.replace(/,/g,""));""==a&&(a=0),n.monto=a,e();const r=function(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}(o);f.value=r})),$("#selectClientes").on("select2:select",(function(e){0!=e.target.value&&t(e.target.value)})),u.addEventListener("click",(function(){id=null,m.reset(),i.disabled=!1,0!=$("#selectClientes").val()?($("#modal-pago").modal("show"),p.value=parseFloat(n.deuda).toLocaleString("en"),v.textContent="$"+parseFloat(n.saldo).toLocaleString("en"),$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;e.append("cliente_id",n.cliente_id),e.append("monto",n.monto),i.disabled=!0;const o=location.origin+"/api/pagar";try{const n=await fetch(o,{method:"POST",body:e}),r=await n.json();i.disabled=!1,$("#modal-pago").modal("hide"),a(),"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),t(c)),setTimeout(()=>{a()},8e3)}catch(e){}}()}}),$("#pagoForm").validate({rules:{monto:{required:!0,customValidation:"0"}},messages:{monto:{required:"El monto a pagar es obligatorio",customValidation:'El monto no puede ser igual a "0"'}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}}),$.validator.addMethod("customValidation",(function(e,t){return function(e,t,o){return e!==o}(e,0,"0")}),'Este campo no puede ser igual a "0"')):Swal.fire({icon:"warning",text:"Por favor seleccione un cliente"})}))}}(),function(){if(document.querySelector("#seccion-fiados")){const e=document.querySelector("#enlace-deudas"),t=document.querySelector("#enlace-pagos"),o=document.querySelector("#contenedor-deudas"),a=document.querySelector("#contenedor-pagos");e.addEventListener("click",()=>{document.querySelector(".active-nav").classList.remove("active-nav"),e.classList.add("active-nav");document.querySelectorAll(".d-none").forEach(e=>{e.classList.remove("d-none")}),a.classList.add("d-none")}),t.addEventListener("click",()=>{document.querySelector(".active-nav").classList.remove("active-nav"),t.classList.add("active-nav");document.querySelectorAll(".d-none").forEach(e=>{e.classList.remove("d-none")}),o.classList.add("d-none")})}}(),function(){if(document.querySelector("#productos")){const a=document.querySelector("#precio_compra"),n=document.querySelector("#precio_venta"),r=document.querySelector("#porcentaje_venta"),c=document.querySelector("#precio_paquete"),i=document.querySelector("#unidades");function e(){a.value="",n.value="",r.value="";const e=parseFloat(c.value.replace(/,/g,"")),t=parseFloat(i.value);if(isNaN(e)||isNaN(t))return;const o=e/t;a.value=Math.round(o).toLocaleString("en")}function t(){const e=parseFloat(a.value.replace(/,/g,"")),t=parseFloat(n.value.replace(/,/g,""));if(isNaN(e)||isNaN(t))return;const o=100*t/e;r.value=o.toFixed(2)}function o(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}a.addEventListener("input",(function(e){const n=o(e.target.value);a.value=n,t()})),n.addEventListener("input",(function(e){const a=o(e.target.value);n.value=a,t()})),r.addEventListener("input",(function(e){!function(e){const t=parseFloat(a.value.replace(/,/g,""));if(isNaN(t))return;const o=parseFloat(e)*t/100;n.value=(100*Math.round(o/100)).toLocaleString("en")}(e.target.value)})),c.addEventListener("input",(function(t){const a=o(t.target.value);c.value=a,e()})),i.addEventListener("input",(function(t){e()}))}}(),function(){if(document.querySelector("#productos")){const c=document.querySelector("#registrar"),i=document.querySelector("#productoForm"),l=document.querySelector("#categoria_id"),s=document.querySelector("#proveedor_id");let d,u,m=null,p=null;const g=document.querySelector("#nombre"),f=document.querySelector("#codigo"),v=document.querySelector("#categoria_id"),h=document.querySelector("#proveedor_id"),b=document.querySelector("#stock"),y=document.querySelector("#stock_minimo"),S=document.querySelector("#precio_compra"),C=document.querySelector("#precio_venta"),T=document.querySelector("#porcentaje_venta"),q=document.querySelector("#btnSubmit");async function e(){try{const e=await fetch("/api/productos-categorias");!function(e){r(l),e.forEach(e=>{const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.categoria,e.id==m&&(t.selected=!0),l.appendChild(t)})}(await e.json())}catch(e){}}async function t(){try{const e=await fetch("/api/productos-proveedores");!function(e){r(s),e.forEach(e=>{const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.nombre,e.id==p&&(t.selected=!0),s.appendChild(t)}),$(".selectCategoria").select2(),$(".selectProveedor").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}(await e.json())}catch(e){}}function o(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function a(){i.reset(),q.disabled=!1,$("#modal-producto").modal("show"),$("#productoForm").validate().resetForm(),$("#productoForm").validate().destroy(),$("#productoForm").find(".is-invalid").removeClass("is-invalid"),u&&async function(){try{const e=await fetch("/api/producto?id="+u);!function(e){m=e.categoria_id,p=e.proveedor_id,g.value=e.nombre.toUpperCase(),f.value=e.codigo,b.value=e.stock,y.value=e.stock_minimo,S.value=parseFloat(e.precio_compra).toLocaleString("en"),C.value=parseFloat(e.precio_venta).toLocaleString("en"),T.value=e.porcentaje_venta}(await e.json())}catch(e){console.log(e)}}(),await e(),await t(),n()}function n(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;u&&e.append("id",u),e.append("nombre",g.value.trim()),e.append("codigo",f.value.trim()),e.append("categoria_id",v.value),e.append("proveedor_id",h.value),e.append("stock",b.value),e.append("stock_minimo",y.value),e.append("precio_compra",S.value),e.append("precio_venta",C.value),e.append("porcentaje_venta",T.value),q.disabled=!0;let t="";t=u?location.origin+"/api/producto/editar":location.origin+"/api/producto/crear";try{const a=await fetch(t,{body:e,method:"POST"}),n=await a.json();o(),q.disabled=!1,"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):(d.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{o()},4e3),i.reset(),$("#modal-producto").modal("hide"))}catch(e){}}()}}),$("#productoForm").validate({rules:{nombre:{required:!0},stock:{required:!0},stock_minimo:{required:!0},precio_compra:{required:!0},precio_venta:{required:!0},porcentaje_venta:{required:!0}},messages:{nombre:{required:"El nombre es obligatorio"},stock:{required:"El stock inicial es obligatorio"},stock_minimo:{required:"El Stock mínimo es obligatorio"},precio_compra:{required:"El precio de compra es obligatorio"},precio_venta:{required:"El precio de venta es obligatorio"},porcentaje_venta:{required:"El porcentaje de venta es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function r(e){for(;e.firstChild;)e.removeChild(e.firstChild)}q.addEventListener("click",(function(){})),$("#tabla").dataTable().fnDestroy(),d=$("#tabla").DataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 to 0 of 0 Entradas",infoFiltered:"(Filtrado de _MAX_ total entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},ajax:"/api/productos",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0}),g.addEventListener("input",(function(e){g.value=e.target.value.toUpperCase()})),c.addEventListener("click",(function(){u=null,m=null,p=null,a()})),$("#tabla").on("click","#editar",(function(e){u=e.currentTarget.dataset.productoId,a()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,t){const a=t.currentTarget.parentElement.parentElement.parentElement.childNodes[2].textContent;console.log(a),Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el producto <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&async function(e){const t=new FormData;t.append("id",e),url=location.origin+"/api/producto/eliminar";try{const e=await fetch(url,{body:t,method:"POST"}),a=await e.json();o(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),setTimeout(()=>{o()},8e3),d.ajax.reload())}catch(e){}}(e)})}(e.currentTarget.dataset.productoId,e)})),$("#productoForm").on("valid",(function(e){n()}))}}(),function(){if(document.querySelector("#productos")){const n=document.querySelector("#stockForm"),r=document.querySelector("#nombre_producto"),c=document.querySelector("#nuevo_stock"),i=document.querySelector("#precio_paquete_nuevo"),l=document.querySelector("#unidades_nuevo"),s=document.querySelector("#precio_compra_nuevo"),d=document.querySelector("#btnSubmitNewStock");let u;function e(){s.value="";const e=parseFloat(i.value.replace(/,/g,"")),t=parseFloat(l.value);if(isNaN(e)||isNaN(t))return;const o=e/t;s.value=Math.round(o).toLocaleString("en")}function t(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}function o(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function a(e){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;e.append("id",u),e.append("stock",c.value),e.append("precio_compra",s.value),d.disabled=!0;const t=location.origin+"/api/producto/editar-stock";try{const a=await fetch(t,{body:e,method:"POST"}),r=await a.json();o(),d.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):($("#tabla").DataTable().ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{o()},4e3),n.reset(),$("#modal-stock").modal("hide"))}catch(e){}}()}}),$("#stockForm").validate({rules:{nuevo_stock:{required:!0},precio_compra_nuevo:{required:!0}},messages:{nuevo_stock:{required:"El nombre es obligatorio"},precio_compra_nuevo:{required:"la nueva cantidad adquirida es obligatoria"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}$("#tabla").on("click","#agregar_stock",(function(e){u=e.currentTarget.dataset.productoId,n.reset(),d.disabled=!1,$("#modal-stock").modal("show"),$("#stockForm").validate().resetForm(),$("#stockForm").validate().destroy(),$("#stockForm").find(".is-invalid").removeClass("is-invalid");const t=e.currentTarget.parentElement.parentElement.parentElement.childNodes[2].textContent;r.value=t,a()})),i.addEventListener("input",(function(o){const a=t(o.target.value);i.value=a,e()})),l.addEventListener("input",(function(t){e()})),s.addEventListener("input",(function(e){const o=t(e.target.value);s.value=o})),$("#stockForm").on("valid",(function(e){a()}))}}(),function(){if(document.querySelector("#proveedores")){let a,n=null;const r=document.querySelector("#registrar"),c=document.querySelector("#proveedorForm"),i=document.querySelector("#nombre"),l=(document.querySelector("#cedula"),document.querySelector("#celular")),s=document.querySelector("#direccion");document.querySelector("#email");function e(){c.reset(),btnSubmit.disabled=!1,$("#modal-proveedor").modal("show"),o(),n&&async function(){try{const e=await fetch("/api/proveedor?id="+n);!function(e){i.value=e.nombre,l.value=e.celular,s.value=e.direccion}(await e.json())}catch(e){console.log(e)}}()}function t(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;n&&e.append("id",n),e.append("nombre",i.value.trim()),e.append("celular",l.value),e.append("direccion",s.value.trim()),btnSubmit.disabled=!0;let o="";o=n?location.origin+"/api/proveedor/editar":location.origin+"/api/proveedor/crear";try{const n=await fetch(o,{body:e,method:"POST"}),r=await n.json();t(),btnSubmit.disabled=!1,"error"==r.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}),setTimeout(()=>{t()},0)):(a.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{t()},4e3),c.reset(),$("#modal-proveedor").modal("hide"))}catch(e){console.log("error")}}()}}),$("#proveedorForm").validate({rules:{nombre:{required:!0,minlength:2},celular:{digits:!0,rangelength:[10,10]}},messages:{nombre:{required:"El nombre es obligatorio",minlength:"Debe tener al menos 2 caracteres"},celular:{digits:"Solo valores númericos",rangelength:"el número de celular debe tener 10 digitos"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}a=$("#tabla").DataTable({ajax:"/api/proveedores",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(a,{buttons:["copy","csv","excel","pdf","print"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),i.addEventListener("input",(function(e){i.value=e.target.value.toUpperCase()})),r.addEventListener("click",(function(){n=null,e()})),$("#tabla").on("click","#editar",(function(t){n=t.currentTarget.dataset.proveedorId,e()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,o){const n=o.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar al Proveedor <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("id",e),url=location.origin+"/api/proveedor/eliminar";try{const e=await fetch(url,{body:o,method:"POST"}),n=await e.json();t(),"error"==n.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}),setTimeout(()=>{t()},4e3)):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{t()},8e3),a.ajax.reload())}catch(e){console.log(e)}}(e)})}(e.currentTarget.dataset.proveedorId,e)})),$("#proveedorForm").on("valid",(function(e){o()}))}}();
//# sourceMappingURL=bundle.js.map
